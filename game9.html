<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect Four</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script>
        const ROW_COUNT = 6;
        const COLUMN_COUNT = 7;
        const SQUARESIZE = 100;
        const RADIUS = SQUARESIZE / 2 - 5;

        const BLUE = "rgb(0,0,255)";
        const BLACK = "rgb(0, 0, 0)";
        const RED = "rgb(255, 0, 0)";
        const YELLOW = "rgb(255, 255, 0)";

        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        document.body.appendChild(canvas);

        canvas.width = COLUMN_COUNT * SQUARESIZE;
        canvas.height = (ROW_COUNT + 1) * SQUARESIZE;

        let turn = 0;
        let game_over = false;

        const board = createBoard();

        function createBoard() {
            return Array.from({ length: ROW_COUNT }, () => Array(COLUMN_COUNT).fill(0));
        }

        function dropPiece(board, row, col, piece) {
            board[row][col] = piece;
        }

        function isValidLocation(board, col) {
            return board[ROW_COUNT - 1][col] === 0;
        }

        function getNextOpenRow(board, col) {
            for (let r = 0; r < ROW_COUNT; r++) {
                if (board[r][col] === 0) {
                    return r;
                }
            }
        }

        function printBoard(board) {
            console.log(board.slice().reverse());
        }

        function winningMove(board, piece) {
            // Check Horizontal
            for (let c = 0; c < COLUMN_COUNT - 3; c++) {
                for (let r = 0; r < ROW_COUNT; r++) {
                    if (
                        board[r][c] === piece &&
                        board[r][c + 1] === piece &&
                        board[r][c + 2] === piece &&
                        board[r][c + 3] === piece
                    ) {
                        return true;
                    }
                }
            }

            // Check Vertical
            for (let c = 0; c < COLUMN_COUNT; c++) {
                for (let r = 0; r < ROW_COUNT - 3; r++) {
                    if (
                        board[r][c] === piece &&
                        board[r + 1][c] === piece &&
                        board[r + 2][c] === piece &&
                        board[r + 3][c] === piece
                    ) {
                        return true;
                    }
                }
            }

            // Check Diagonals
            for (let c = 0; c < COLUMN_COUNT - 3; c++) {
                for (let r = 0; r < ROW_COUNT - 3; r++) {
                    if (
                        board[r][c] === piece &&
                        board[r + 1][c + 1] === piece &&
                        board[r + 2][c + 2] === piece &&
                        board[r + 3][c + 3] === piece
                    ) {
                        return true;
                    }
                }
            }

            // Check neg Diagonals
            for (let c = 0; c < COLUMN_COUNT - 3; c++) {
                for (let r = 3; r < ROW_COUNT; r++) {
                    if (
                        board[r][c] === piece &&
                        board[r - 1][c + 1] === piece &&
                        board[r - 2][c + 2] === piece &&
                        board[r - 3][c + 3] === piece
                    ) {
                        return true;
                    }
                }
            }

            return false;
        }

        function drawBoard(board) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let c = 0; c < COLUMN_COUNT; c++) {
                for (let r = 0; r < ROW_COUNT; r++) {
                    ctx.fillStyle = BLUE;
                    ctx.fillRect(c * SQUARESIZE, r * SQUARESIZE + SQUARESIZE, SQUARESIZE, SQUARESIZE);

                    ctx.beginPath();
                    ctx.arc(
                        c * SQUARESIZE + SQUARESIZE / 2,
                        r * SQUARESIZE + SQUARESIZE * 1.5,
                        RADIUS,
                        0,
                        Math.PI * 2
                    );

                    ctx.fillStyle = BLACK;
                    ctx.fill();
                    ctx.closePath();

                    if (board[r][c] === 1) {
                        ctx.beginPath();
                        ctx.arc(
                            c * SQUARESIZE + SQUARESIZE / 2,
                            canvas.height - (r * SQUARESIZE + SQUARESIZE / 2),
                            RADIUS,
                            0,
                            Math.PI * 2
                        );

                        ctx.fillStyle = RED;
                        ctx.fill();
                        ctx.closePath();
                    } else if (board[r][c] === 2) {
                        ctx.beginPath();
                        ctx.arc(
                            c * SQUARESIZE + SQUARESIZE / 2,
                            canvas.height - (r * SQUARESIZE + SQUARESIZE / 2),
                            RADIUS,
                            0,
                            Math.PI * 2
                        );

                        ctx.fillStyle = YELLOW;
                        ctx.fill();
                        ctx.closePath();
                    }
                }
            }

            requestAnimationFrame(() => drawBoard(board));
        }

        drawBoard(board);

        canvas.addEventListener("mousemove", (event) => {
            ctx.fillStyle = BLACK;
            ctx.fillRect(0, 0, canvas.width, SQUARESIZE);

            const posx = event.clientX - canvas.getBoundingClientRect().left;

            ctx.beginPath();
            ctx.arc(posx, SQUARESIZE / 2, RADIUS, 0, Math.PI * 2);

            ctx.fillStyle = turn === 0 ? RED : YELLOW;
            ctx.fill();
            ctx.closePath();
        });

        canvas.addEventListener("mousedown", (event) => {
            ctx.fillStyle = BLACK;
            ctx.fillRect(0, 0, canvas.width, SQUARESIZE);

            const posx = event.clientX - canvas.getBoundingClientRect().left;
            const col = Math.floor(posx / SQUARESIZE);

            if (isValidLocation(board, col)) {
                const row = getNextOpenRow(board, col);
                dropPiece(board, row, col, turn + 1);

                if (winningMove(board, turn + 1)) {
                    const winnerText = turn === 0 ? "Player 1 WON!!!" : "Player 2 WON!!!";
                    console.log(winnerText);
                    game_over = true;
                }

                printBoard(board);
                drawBoard(board);

                turn = 1 - turn;

                if (game_over) {
                    setTimeout(() => {
                        console.log("Game Over");
                    }, 3000);
                }
            }
        });
    </script>
</body>
</html>
